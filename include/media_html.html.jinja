{#
 # SPDX-FileCopyrightText: 2025 David Mandelberg <david@mandelberg.org>
 #
 # SPDX-License-Identifier: Apache-2.0
 #}

{% set media = ginjarator.py.import_("dseomn_website.media") %}

{% macro image(image_metadata, profile_name) -%}
  {%- set profile = media.IMAGE_PROFILES[profile_name] -%}
  {%- set primary_output = profile.primary_output(image_metadata.source) -%}
  {%- set outputs = profile.unique_outputs(image_metadata.source) -%}
  <img
      sizes="{{ profile.responsive_sizes() | e }}"
      {% if none not in (primary_output.url_path, primary_output.metadata) %}
        src="{{ primary_output.url_path | e }}"
        height="{{ primary_output.metadata.geometry.height | e }}"
        width="{{ primary_output.metadata.geometry.width | e }}"
      {% endif %}
      srcset="
        {%- set srcset_joiner = joiner(", ") -%}
        {%- for output in outputs if none not in (
          output.url_path,
          output.metadata,
        ) -%}
          {{- srcset_joiner() -}}
          {{ output.url_path | e }} {{ output.metadata.geometry.width | e }}w
        {%- endfor -%}
      "
      class="image-{{ profile_name.replace("_", "-") | e }}"
      loading="lazy"
      alt="{{ image_metadata.alt | e }}"
      >
{%- endmacro %}

{% macro gallery(page_metadata, gallery_name) %}
  <div class="gallery">
    {% for media_item in page_metadata.media.item_by_source.values()
      if media_item.gallery == gallery_name
    %}
      {% if media_item.type_ == "image" %}
        {# TODO: dseomn - Show the full image in a better way. #}
        <a
            href="{{
              media.IMAGE_PROFILES.full_screen.primary_output(
                media_item.source
              ).url_path | e
            }}"
            >
          {{ image(media_item, "gallery_thumbnail") }}
        </a>
      {% else %}
        {% do ginjarator.py.assert_(false) %}
      {% endif %}
    {% endfor %}
  </div>
{% endmacro %}
